# Zookeeper

## 定位
zookeeper是一个为分布式提供分布式的，开源的协调服务的应用。它暴露了一系列原语，分布式应用可以基于这些原语来实现一些高等级的服务，像同步，配置维护，分组，命名。它被设计成类似于文件系统的目录结构

## 特点
**顺序一致性**
保证进来的数据逐一执行,不进行并发

ZK是有序的，它为每个事务都标记了一个版本号（邮戳），随后可以使用一些操作完成更高级别的抽象，像同步锁

**原子性**
保证更新操作要么成功要么失败
**单系统镜像**
保证主从模型中的所有server存储数据一致
**持久化(可靠性)**
指数据会持久化
**及时性**
数据会在一小段时间内达到最终一致性

## 基础
### 数据结构
分层命名空间，类似于文件系统的目录树结构
其中存储的是node，node大小为1M

### zookeeper集群结构
![zkservice](picture/zkservice.jpg)
主从复制集群，里面有leader，读写分离，可能会产生主的单点故障问题，为了解决单点故障问题，引入新的技术

**优势**
官方压测，在主宕机之后，会暂停一段时间的服务，时长不超过200ms，然后就能立即选出一个新的主对外提供服务

zookeeper数据也是存在内存中的，速度非常快，吞吐量很高。ZK支持复制，主从复制，读写分离。推荐读写比10:1，速度最快

ZK 服务器彼此认识。他们维护一个内存中的图像的状态,以及一个事务日志和一个供持久化存储使用的快照。只要大部分服务器可以,ZK就服务可用。

### 客户端连接服务器做的事情
客户端连接到服务器，客户端维护了TCP连接，做了如下几件事
1.发送请求
2.获取监听的事件
3.获取响应
4.发送心跳
如果连接断开，客户端会选择其他服务器

### node（持久节点） 和 ephemeral（短暂，临时） node
node是zk中的节点，每个节点都容量都很小，只有1M，为了提高zk的速度，不适合用作数据库

持久节点:
临时节点:使用session进行通讯
序列节点:

## 安装