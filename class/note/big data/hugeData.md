# 大数据架构

## 数据仓库基础

### 数据库与ER建模

#### ER实体关系模型

OLTP（联机事务处理）：增删改查的事务型操作

OLAP（联机分析处理）：数据仓库的数据分析的sql查询

### 数据仓库（DW）

为什么要有数据仓库？

1.各种各样的细节数据存在于各个不同的关系型数据库中，需要数据仓库对数据进行一个整合分析

2.关系型数据库中存储的数据库一般是最基本的，日常事务处理的，面向业务操作的数据，数据一般可以更新状态删除条目等，不能直接反应趋势的变化。数据日志更有分析价值，但是不会存入关系型数据库

3.决策者必须从不同的商业角度观察数据，比如说产品，地区，客户群等不同方面观察数据

所以必须对各类数据进行汇集，清洗，汇总，管理，脱敏等，找出战略决策信息，需要建立数据仓库

#### 构建数据仓库的意义

数据的分部杂乱无章，一般我们的web系统都会依赖于各种关系型数据库，而这些关系型数据库存储的信息往往是比较具体的，比较乱的，对数据的分析产生不便，并且数据库不会存大量日志记录，而这些日志记录恰好是分析一些MOT（用户G点）的关键所在，所以需要构建数据仓库，来结构化数据，进行数据治理，汇集，清洗，管理

#### 定义
数据仓库是面向主题的，集成的（非简单的数据堆积），相对稳定的，反应历史变化的数据集合，数仓中的数据是有组织有结构的存储数据集合，用于对管理决策过程的支持

#### 原则
1.面向主题的
2.集成的
3.包含历史的
4.不可更新的
5.面向决策支持的
6.面向全企业的
7.最明细的数据存储
8.数据快照式的数据获取

#### 架构
自上而下
业务系统->数据ETL->数据仓库->数据集市
自下而上
业务系统->数据ETL->数据仓库（数据集市）
CIF（Corporation information factory）架构
ODS（范式建模）DW,DM（维度建模）

### 维度建模

主要源自数据集市，主要面向市场分析

#### 分表
##### 事实表

经常变化的

发生在现实世界中的操作型事件，其产生的可度量数值，存储在事实表中

维度（每个维度列都会对应一张维度表）+度量构成

用每个维度对维度表进行关联，可以站在更多的维度上去进行分析

通用命名规范：fact_xxxxxx

##### 维度表

不是经常变化的

单一主键，包含很多属性列（用拉链表解决缓慢变化的问题）

通用命名规范：dim_xxxxxx
#### 数据仓库的分析模型
##### 星型模型
存在冗余，单层维度
##### 雪花模型
范式设计，主要是对维度表的拆分，分析效率比星型模型效率低
##### 星座模型
事实表共用维度就叫星座模型

#### 数据仓库的分层

##### 数据分层好处

1.减少重复开发

2.清晰的数据结构

3.统一数据出口

4.简化问题

#### 通用架构
DM（Data Mart数据集市）  DW（Data Warehouse数据仓库）  ODS（Operational Data Store操作数据层，贴源层）  (数据库)

ODS：抽取业务系统的数据，将不同业务系统中的数据汇聚在一起（范式建模）
DW：

> DWD层（Data Warehouse Detail数据明细层）：基于ODS层数据加工，提供更干净的数据（数据清洗，数据一致性的处理）（范式建模）
> DWM层（Data Warehouse Middle数据中间层）：对于通用的维度进行聚合统计（轻度聚合）（维度建模）
> DWS层（Data Warehouse Service数据服务层）：按照业务组织主题宽表，用于OLAP分析（重度聚合）（维度建模）

DM（APP层）：基于DW上的基础数据，整合汇总成分析某一个主题域的报表数据（维度建模）
给机器学习部门提供学习模型，给运营提供展示方便运营进行决策（直接用可视化框架），给web项目以接口方式提供结果

#### 数据库与数据仓库区别

数据库：传统关系型数据库主要应用是OLTP，做业务处理

数据仓库：主要是OLAP，做数据分析

1.数据范围：数据库当前数据，数据仓库完整历史数据

2.数据变化：数据库频繁增删改查，数据仓库增查，无更新删除

3.应用场景：数据库面向业务交易流程，数据仓库面向分析，侧重决策分析

4.数据量：数据库频繁小批次高并发低延迟，数据仓库非频繁，大批量高吞吐，有延迟

5.设计理论：数据库遵循三范式，避免冗余，数据仓库反范式，适当冗余

6.建模方式：数据库范式建模，数据仓库范式建模+维度建模

# 项目架构

离线批数据处理

1.sqoop增量或者全量导入数据（关系型数据库）

2.用户日志数据（运维人员每日上报数据，上报到HDFS）- > 使用SparkCore + SparkSql（清洗数据）

3.数据仓库：ODS,DW,DM（每一层基于SparkSql）

4.出口数据存在数据库中，然后以接口方式提供web服务，可视化工具报表展示（内部人员）

时实数据处理

1.Flume

2.数据存入Kafka

3.流式处理SparkStreaming/Flink

资源调度

1.Yarn

2.Azkaban进行任务流调度

## 表规范

看表规范

# 杂项
cube开发：多维开发，多个维度进行分析